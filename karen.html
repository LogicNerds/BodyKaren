<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Object Launch ‚Äî Take Down the Karen (Sprite Build)</title>
<style>
/* üé® Spruce Up Look: Subtle color changes & shadows */
:root{
  --ink:#f8faff; 
  --line:#ffffff33; 
  --panel1:#0c1118;
  --panel2:#121826;
  --accent:#56b5f5; 
  --accent2:#ff82c5; 
  --ok:#27df9d; --warn:#ffd166;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#090e14,#0b1426);color:var(--ink);font-family:system-ui,Segoe UI,Arial,sans-serif;}

/* üõ†Ô∏è DEAD SPACE FIX: Reduced top padding on wrap */
.wrap{max-width:1100px;margin:0 auto;padding:0 14px 10px 14px;} 
.hud{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:8px} 
.panel{background:linear-gradient(180deg,var(--panel1),var(--panel2));border:1px solid var(--line);border-radius:16px;padding:10px 14px;box-shadow:0 12px 36px #0008} 
.title{font-weight:900;letter-spacing:.3px}
.items{display:flex;gap:8px;flex-wrap:wrap}
.itemBtn{cursor:pointer;border:1px solid var(--line);background:#ffffff10;color:var(--ink);border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center;user-select:none;box-shadow:0 6px 16px #0006;transition:transform 0.1s; font-size: 14px;}
.itemBtn:hover{transform:translateY(-1px);background:#ffffff18;}
.itemBtn .emoji{font-size: 20px;} 
.itemBtn.active{outline:2px solid var(--accent);box-shadow:0 0 10px var(--accent), 0 6px 16px #0008;} 
.itemBtn.used{opacity:.3;filter:grayscale(1);cursor:not-allowed;box-shadow:none;}
.foot{opacity:.8;font-size:12px;margin-top:6px}

.stageWrap{position:relative;border-radius:18px;border:1px solid var(--line);overflow:hidden;background:radial-gradient(1200px 600px at 80% 0,#223554,#121725);box-shadow:0 12px 40px #0008;} 

/* üõ†Ô∏è ARENA SPACE FIX: Increased canvas height */
canvas{display:block;width:100%;height:700px} 

.overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(3px)}
.overlay .box{background:#111622;border:1px solid var(--line);border-radius:16px;padding:18px 20px;max-width:560px;text-align:center;box-shadow:0 18px 50px #000a}
.overlay h2{margin:0 0 8px}
.overlay .row{display:flex;gap:10px;justify-content:center;margin-top:10px}
.btn{cursor:pointer;border:0;border-radius:12px;padding:10px 14px;font-weight:900;transition:transform 0.1s;}
.btn:hover{transform:translateY(-1px);}
.btnPrimary{background:linear-gradient(135deg,#56b5f5,#237eff);color:#001220} 
.btnGhost{background:#ffffff16;border:1px solid var(--line);color:var(--ink)}
</style>
</head>
<body>
<div class="wrap">
  <div class="hud">
    <div class="panel">
      <div class="title">Object Launch ‚Äî Take Down the Karen</div>
      <div class="foot">Drag the band, aim, release. 30s to make her <b>take the L</b>.</div>
    </div>
    <div class="panel">
      <div class="items" id="items"></div>
      <div class="foot">One of each. Used items gray out.</div>
    </div>
  </div>

  <div class="stageWrap">
    <canvas id="stage" width="1100" height="700"></canvas>
    <div class="overlay" id="ovl">
      <div class="box">
        <h2 id="ovlTitle">Mission Complete</h2>
        <div id="ovlMsg">Karen took the L in 18.2s.</div>
        <div class="row">
          <button class="btn btnPrimary" id="again">Play again</button>
          <button class="btn btnGhost" id="share">Copy score</button>
        </div>
      </div>
    </div>
  </div>
  <div class="foot" style="margin-top:8px;opacity:.7">Cartoon NPC only. Bonks, not bruises.</div>
</div>

<script>
/* ================================
    SPRITES (embedded SVG ‚Üí dataURL)
==================================*/
const S = (svg) => 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
const E = (emoji) => `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><text x="30" y="45" font-size="48" text-anchor="middle">${emoji}</text></svg>`;

const SPRITES = {
  toaster: E(`üçû`), 
  pan: E(`üç≥`), 
  bat: E(`‚öæ`), 
  pot: E(`ü™¥`), 
  laptop: E(`üíª`), 
  chair: E(`ü™ë`), 
  chicken: E(`üçó`), 
  mug: E(`‚òï`), 
  stapler: E(`üìé`), 
  shoe: E(`üëü`), 
  book: E(`üìö`), 
  sandwich: E(`ü•™`), 
  banana: E(`üçå`), 
  balloon: E(`üéà`), 
  pencil: E(`‚úèÔ∏è`) 
};

const KAREN = S(`<svg xmlns="http://www.w3.org/2000/svg" width="140" height="240" viewBox="0 0 140 240">
  <defs>
    <linearGradient id="sk" x1="0" x2="0" y1="0" y2="1">
      <stop stop-color="#ffe0a8"/><stop offset="1" stop-color="#ffc98c"/>
    </linearGradient>
    <linearGradient id="cl" x1="0" x2="1">
      <stop stop-color="#fefefe"/><stop offset="1" stop-color="#e3e6ee"/>
    </linearGradient>
  </defs>
  <rect x="52" y="150" width="18" height="70" rx="8" fill="url(#sk)" stroke="#d8a36a" stroke-width="3"/>
  <rect x="78" y="150" width="18" height="70" rx="8" fill="url(#sk)" stroke="#d8a36a" stroke-width="3"/>
  <path d="M40 80 L100 80 L120 150 L20 150 Z" fill="url(#cl)" stroke="#a9b3c4" stroke-width="3"/>
  <rect x="18" y="90" width="18" height="60" rx="8" fill="url(#sk)" stroke="#d8a36a" stroke-width="3"/>
  <rect x="104" y="90" width="18" height="60" rx="8" fill="url(#sk)" stroke="#d8a36a" stroke-width="3"/>
  <rect x="118" y="112" width="10" height="18" rx="2" fill="#333"/>
  <circle cx="70" cy="56" r="22" fill="url(#sk)" stroke="#d8a36a" stroke-width="3"/>
  <circle cx="62" cy="52" r="3" fill="#333"/><circle cx="78" cy="52" r="3" fill="#333"/>
  <rect x="62" y="62" width="16" height="4" rx="2" fill="#333"/>
</svg>`);

/* ================================
    CONFIG
==================================*/
const ITEMS = [
  { id:'toaster',    name:'Toaster',    emoji:'üçû', img:SPRITES.toaster,    base:2.4 },
  { id:'pan',        name:'Pan',        emoji:'üç≥', img:SPRITES.pan,        base:2.2 },
  { id:'bat',        name:'Bat',        emoji:'‚öæ', img:SPRITES.bat,        base:2.0 },
  { id:'pot',        name:'Plant Pot',  emoji:'ü™¥', img:SPRITES.pot,        base:1.9 },
  { id:'laptop',     name:'Laptop',     emoji:'üíª', img:SPRITES.laptop,     base:1.8 },
  { id:'chair',      name:'Chair',      emoji:'ü™ë', img:SPRITES.chair,      base:1.7 },
  { id:'chicken',    name:'Rubber Chicken', emoji:'üçó', img:SPRITES.chicken, base:1.4 },
  { id:'mug',        name:'Mug',        emoji:'‚òï', img:SPRITES.mug,        base:1.1 },
  { id:'stapler',    name:'Stapler',    emoji:'üìé', img:SPRITES.stapler,    base:1.0 },
  { id:'shoe',       name:'Shoe',       emoji:'üëü', img:SPRITES.shoe,       base:1.0 },
  { id:'book',       name:'Book',       emoji:'üìö', img:SPRITES.book,       base:0.9 },
  { id:'sandwich',   name:'Sandwich',   emoji:'ü•™', img:SPRITES.sandwich,   base:0.6 },
  { id:'banana',     name:'Banana',     emoji:'üçå', img:SPRITES.banana,     base:0.5 },
  { id:'balloon',    name:'Balloon',    emoji:'üéà', img:SPRITES.balloon,    base:0.4 },
  { id:'pencil',     name:'Pencil',     emoji:'‚úèÔ∏è', img:SPRITES.pencil,     base:0.35 }
];

const MULT = { head:1.8, torso:1.2, arm:0.9, leg:0.8, foot:0.5 };
const WIN_HP = 15;
const ROUND_SECS = 30;

/* ================================
    DOM
==================================*/
const stage = document.getElementById('stage'), ctx = stage.getContext('2d');
const itemsEl = document.getElementById('items');
const ovl = document.getElementById('ovl'), ovlTitle = document.getElementById('ovlTitle'), ovlMsg = document.getElementById('ovlMsg');
document.getElementById('again').onclick = () => resetGame();
document.getElementById('share').onclick = () => {
  const txt = `Karen took the L: ${Math.floor(hp)}/${WIN_HP} HP in ${elapsedText()}`;
  navigator.clipboard?.writeText(txt);
};

/* Build inventory (one of each) */
let armed = null;
let inventory = new Map(); // id -> {used:bool, img:Image, meta:item, btn:HTMLElement}
function buildInventory(){
  itemsEl.innerHTML = '';
  inventory.clear();
  ITEMS.forEach(it=>{
    const img = new Image(); img.src = it.img;
    const btn = document.createElement('button');
    btn.className = 'itemBtn'; 
    btn.innerHTML = `<span class="emoji">${it.emoji}</span>${it.name}`;
    btn.onclick = ()=>{
      if(btn.classList.contains('used')) return;
      armed = it.id;
      document.querySelectorAll('.itemBtn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
    };
    itemsEl.appendChild(btn);
    inventory.set(it.id, { used:false, img, meta:it, btn });
  });
}
buildInventory();

/* ================================
    Canvas sizing
==================================*/
let W, H; const GROUND = () => H-40;
function resize(){
  const r = stage.getBoundingClientRect();
  W = stage.width = Math.floor(r.width);
  H = stage.height = Math.floor(r.height);
}
addEventListener('resize', resize); resize();

/* ================================
    Game state & physics
==================================*/
const GRAV = 1600;
// üõ†Ô∏è ARENA SPACE FIX: Slingshot position moved up (from -100 to -200) relative to ground
const SLING = { x: 140, y: () => GROUND()-200, maxPull: 230, bandTension: 0.04 }; 

const kar = { // Karen
  x: () => W-210, y: () => GROUND()-220, w: 140, h: 240, 
  img: (()=>{ const i=new Image(); i.src=KAREN; return i; })()
};

let projectiles = [];
let hp = 0, startTime = null, over = false;

function elapsedText(){
  if(!startTime) return '0.0s';
  const s = Math.max(0, (performance.now()-startTime)/1000);
  return s.toFixed(1)+'s';
}

/* Input: drag to aim */
let dragging=false, dragStart=null, dragNow=null, dragTimeStart=null; 
function toPos(e){ const r=stage.getBoundingClientRect(); const p=e.touches?e.touches[0]:e; return {x:p.clientX-r.left, y:p.clientY-r.top}; }
function onDown(e){ 
  if(over) return;
  const p=toPos(e); dragging=true; dragStart=p; dragNow=p; 
  dragTimeStart = performance.now(); 
  e.preventDefault(); 
}
function onMove(e){ if(!dragging) return; dragNow=toPos(e); e.preventDefault(); }
function onUp(e){
  if(!dragging) return;
  dragging=false;
  if(!armed) return;
  
  const pullX = dragStart.x - dragNow.x;
  const pullY = dragStart.y - dragNow.y;
  const pullMag = Math.hypot(pullX, pullY);
  
  if(pullMag < 10) return;

  // üöÄ NEW PHYSICS: Calculate power based on time held (additive)
  const holdDurationSeconds = Math.max(0, (performance.now() - dragTimeStart) / 1000);
  const cappedDuration = Math.min(5, holdDurationSeconds); // Cap at 5 seconds
  
  // Calculate power using an exponential function of time (3^t) to simulate tripling
  // We normalize this to a range between a minimum launch speed and a max added speed.
  const MIN_SPEED = 1000;
  const MAX_ADDED_SPEED = 10000; // Increased max launch potential
  
  // Calculate the time-based multiplier (0 at 0s, 1 at 5s) using 3^t scale:
  // We use the cappedDuration and map it from 3^0 to 3^5 (1 to 243)
  const timePowerFactor = (Math.pow(3, cappedDuration) - 1) / (Math.pow(3, 5) - 1);
  
  // The added speed scales by time (exponentially)
  const addedSpeed = MAX_ADDED_SPEED * timePowerFactor; 
  
  // Incorporate distance pulled (capped by maxPull) for aim sensitivity
  const cappedPullMag = Math.min(SLING.maxPull, pullMag);
  const distanceFactor = cappedPullMag / SLING.maxPull;
  
  // Final speed is minimum speed plus the distance-scaled power from holding time
  const speed = MIN_SPEED + (addedSpeed * distanceFactor);

  const angle = Math.atan2(pullY, pullX);
  const vx = Math.cos(angle) * speed;
  const vy = Math.sin(angle) * speed; 

  const slot = inventory.get(armed);
  projectiles.push({
    id: armed, img: slot.img, base: slot.meta.base,
    x: SLING.x, y: SLING.y(), vx, vy, r: 16 + Math.min(14, slot.meta.base*5),
    alive: true, hit: false, rot: Math.random()*Math.PI
  });

  // consume the item
  slot.used = true; slot.btn.classList.remove('active'); slot.btn.classList.add('used'); armed = null;

  if(!startTime){ startTime = performance.now(); }
}
stage.addEventListener('mousedown',onDown); stage.addEventListener('mousemove',onMove); addEventListener('mouseup',onUp);
stage.addEventListener('touchstart',onDown,{passive:false}); stage.addEventListener('touchmove',onMove,{passive:false}); stage.addEventListener('touchend',onUp);

/* ================================
    Collision
==================================*/
function karHitboxes(){
  const x = kar.x(), y = kar.y();
  return {
    head: {x:x+50, y:y+18, w:40, h:40, mult:MULT.head},
    torso:{x:x+28, y:y+60, w:84, h:90, mult:MULT.torso},
    armL: {x:x+12, y:y+72, w:20, h:70, mult:MULT.arm},
    armR: {x:x+108,y:y+72, w:20, h:70, mult:MULT.arm},
    legL: {x:x+52, y:y+150,w:22, h:70, mult:MULT.leg},
    legR: {x:x+82, y:y+150,w:22, h:70, mult:MULT.leg},
    foot:{x:x+52, y:y+222,w:52, h:16, mult:MULT.foot}
  };
}
function circleHitsBox(cx,cy,r,B){
  const nx = Math.max(B.x, Math.min(cx, B.x+B.w));
  const ny = Math.max(B.y, Math.min(cy, B.y+B.h));
  const dx = cx-nx, dy = cy-ny;
  if(dx*dx + dy*dy <= r*r) return {cx:nx, cy:ny, mult:B.mult};
  return null;
}

/* ================================
    Loop
==================================*/
let last = performance.now();
requestAnimationFrame(tick);

function tick(){
  const t = performance.now(), dt = Math.min(0.033, (t-last)/1000); last = t;

  update(dt);
  draw();

  if(!over) requestAnimationFrame(tick);
}

function update(dt){
  // timer
  if(startTime && !over){
    const rem = Math.max(0, ROUND_SECS - (performance.now()-startTime)/1000);
    if(rem <= 0){ finish(false); return; }
  }

  // physics
  for(const p of projectiles){
    if(!p.alive) continue;
    p.vy += GRAV * dt;
    p.x  += p.vx * dt;
    p.y  += p.vy * dt;
    p.rot += 2*dt;

    // floor bounce
    if(p.y + p.r > GROUND()){
      p.y = GROUND() - p.r;
      p.vy *= -0.38;
      p.vx *=  0.72;
      if(Math.abs(p.vy) < 60) p.alive = false;
    }
    // walls
    if(p.x < -80 || p.x > W+80 || p.y < -120) p.alive=false;

    // collision with Karen
    if(!p.hit && p.x > W-280){
      const boxes = karHitboxes();
      const hit = circleHitsBox(p.x,p.y,p.r,boxes.head) || circleHitsBox(p.x,p.y,p.r,boxes.torso) ||
                   circleHitsBox(p.x,p.y,p.r,boxes.armL) || circleHitsBox(p.x,p.y,p.r,boxes.armR) ||
                   circleHitsBox(p.x,p.y,p.r,boxes.legL) || circleHitsBox(p.x,p.y,p.r,boxes.legR) ||
                   circleHitsBox(p.x,p.y,p.r,boxes.foot);
      if(hit){
        p.hit = true;
        const variance = 0.9 + Math.random()*0.2;
        const gain = +(p.base * hit.mult * variance).toFixed(2);
        addHP(gain, p.x, p.y); 
        // dampen
        p.vx *= 0.6; p.vy *= 0.6;
      }
    }
  }
  projectiles = projectiles.filter(p=>p.alive);
}

function addHP(g, x, y){
  hp = Math.min(WIN_HP, +(hp + g).toFixed(2));
  // floating text near hit
  ctx.save();
  // quick DOM floaty near canvas:
  const fl = document.createElement('div');
  fl.textContent = '+'+g.toFixed(2);
  const r = stage.getBoundingClientRect();
  fl.style.position='fixed'; fl.style.left=(r.left+x)+'px'; fl.style.top=(r.top+y)+'px';
  fl.style.transform='translate(-50%,-50%)'; fl.style.fontWeight='900';
  fl.style.color = g>=2 ? 'var(--accent2)' : (g>=1 ? 'var(--warn)' : 'var(--accent)');
  fl.style.textShadow='0 2px 0 #000a'; fl.style.pointerEvents='none'; fl.style.zIndex='100';
  fl.style.transition='all .7s ease-out'; fl.style.opacity='1';
  document.body.appendChild(fl);
  requestAnimationFrame(()=>{ fl.style.opacity='0'; fl.style.top=(r.top+y-80)+'px'; });
  setTimeout(()=>fl.remove(), 800);

  if(hp >= WIN_HP) finish(true);
}

function finish(win){
  over = true;
  ovl.style.display='flex';
  ovlTitle.textContent = win ? 'Mission Complete' : 'Time‚Äôs Up';
  ovlMsg.innerHTML = win
    ? `Karen <b>took the L</b> in <b>${elapsedText()}</b>.`
    : `You reached <b>${Math.floor(hp)}/${WIN_HP} HP</b>. Try heavier items or aim for the head.`;
}

function resetGame(){
  hp = 0; startTime = null; over = false;
  projectiles = [];
  buildInventory();
  ovl.style.display='none';
  last = performance.now();
  requestAnimationFrame(tick);
}

/* ================================
    Rendering
==================================*/
function draw(){
  // bg
  ctx.clearRect(0,0,W,H);
  // ground
  ctx.fillStyle = '#222a36';
  ctx.fillRect(0,GROUND(),W,H-GROUND());
  ctx.fillStyle = '#2b3544';
  for(let i=0;i<W;i+=32) ctx.fillRect(i,GROUND(),16,6);

  // slingshot band + post
  const slingY = SLING.y();
  ctx.save();
  // posts
  ctx.fillStyle='#2e394b';
  // üõ†Ô∏è Slingshot posts are now taller to match the new position
  ctx.fillRect(SLING.x-6, slingY-120, 12, 120); 
  ctx.fillRect(SLING.x+32-6, slingY-120, 12, 120); 
  // band
  if(dragging){
    ctx.strokeStyle = 'var(--accent2)'; 
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(SLING.x, slingY-44);
    ctx.lineTo(dragNow.x, dragNow.y);
    ctx.lineTo(SLING.x+32, slingY-44);
    ctx.stroke();
  } else {
    ctx.strokeStyle = '#ffa8d0';
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(SLING.x, slingY-44);
    ctx.lineTo(SLING.x+16, slingY-52);
    ctx.lineTo(SLING.x+32, slingY-44);
    ctx.stroke();
  }
  // pouch
  ctx.fillStyle='#333';
  ctx.fillRect(SLING.x+8, slingY-52, 16, 10);
  ctx.restore();

  // Karen sprite
  ctx.drawImage(kar.img, kar.x(), kar.y(), kar.w, kar.h);

  // Karen HUD (HP bar + timer) just above head
  const hudX = kar.x()+20, hudY = kar.y()-18;
  // HP bar frame
  ctx.save();
  ctx.fillStyle = 'rgba(0,0,0,.55)';
  ctx.fillRect(hudX-2, hudY-10, 120+4, 10+4);
  // fill
  const pct = hp/WIN_HP;
  ctx.fillStyle = pct>=1 ? 'var(--ok)' : (pct>0.6 ? 'var(--warn)' : 'var(--accent)');
  ctx.fillRect(hudX, hudY-8, Math.max(0,120*pct), 8);
  // border
  ctx.strokeStyle = 'var(--line)'; 
  ctx.strokeRect(hudX, hudY-8, 120, 8);
  // timer text
  let tLeft = startTime ? Math.max(0, ROUND_SECS - (performance.now()-startTime)/1000) : ROUND_SECS;
  ctx.fillStyle = 'var(--ink)'; 
  ctx.font = 'bold 12px system-ui, sans-serif';
  ctx.fillText((tLeft).toFixed(1)+'s', hudX+126, hudY);
  ctx.restore();

  // projectiles
  for(const p of projectiles){
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rot);
    const size = p.r*2;
    ctx.drawImage(p.img, -size/2, -size/2, size, size);
    ctx.restore();
  }
}
</script>
</body>
</html>